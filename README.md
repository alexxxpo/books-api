# Тестовое задание для Back-end Node.js разработчика: Разработка RESTful API для управления коллекцией книг с расширенными функциями

## Запуск приложения
### Запуск сервера
```
npm install
npx prisma generate
```

После установки всех зависимостей и запуска базы данных необходимо произвести миграцию для добавления модели в базу данных
```
npx prisma migrate dev --name init
```
Также через любой клиент установить роли в таблица Roles (1 - пользователь (=0b01), 3 - администратор* (=0b11))
Для проверки прав администратора задать права в таблице пользователю

создать файл .env
указать переменные

    #docker, database
    DB_USER="postgres"
    DB_NAME="postgres"
    DB_PASSWORD=12345
    DB_HOST="postgres"
    DB_PORT=5432
    DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?schema=public

    #JWT
    SECRET_KEY="jwtoken secret key"

    #nodemailer
    SMTP_HOST="Ваш почтовый сервер"
    SMTP_PORT=465
    SMTP_USER="логин"
    SMTP_PASSWORD="пароль"
    SMTP_FROM="адрес, с которого будет отправлено письмо"

    #host для ссылки подтверждения, на который нужно будет перейти из письма пользователя
    HOST="localhost:3000"

Для запуска используйте следующие скрипты
```
"scripts": {
    "dev": "nodemon app.ts",
    "build": "npx tsc",
    "start": "npm run build && node dist/app.js"
  }
```
### Docker
Для сервера создан Dockerfile
В docker-compose запускаются сервер и база данных
После запуска в терминале сервера необходимо произвести миграцию для добавления модели в базу данных
```
npx prisma migrate dev --name init
```
Также через любой клиент установить роли в таблица Roles (1 - пользователь (=0b01), 3 - администратор* (=0b11))
Для проверки прав администратора задать права в таблице пользователю

### Роуты для тестирования в postman
localhost:3000/books
localhost:3000/books/:id

localhost:3000/users/register
localhost:3000/users/login
localhost:3000/users/me
localhost:3000/users/:id/role

## Описание задания

Вам нужно разработать RESTful API для управления коллекцией книг. API должно позволять пользователям добавлять книги, просматривать список книг, обновлять информацию о книгах и удалять книги. Кроме того, API должно иметь функции для управления пользователями и их ролями с использованием битовых масок.

1. Добавление книги
- HTTP метод: POST
- Эндпоинт: /books
- Тело запроса: JSON с полями title, author, publicationDate, genres
- Ответ: JSON с данными добавленной книги
- Требует аутентификации (только для пользователей с ролью "администратор")

2. Получение списка книг
- HTTP метод: GET
- Эндпоинт: /books
- Ответ: JSON массив с данными всех книг

3. Получение книги по ID
- HTTP метод: GET
- Эндпоинт: /books/:id
- Ответ: JSON с данными книги

4. Обновление информации о книге
- HTTP метод: PUT
- Эндпоинт: /books/:id
- Тело запроса: JSON с полями title, author, publicationDate, genres
- Ответ: JSON с данными обновленной книги
- Требует аутентификации (только для пользователей с ролью "администратор")

5. Удаление книги
- HTTP метод: DELETE
- Эндпоинт: /books/:id
- Требует аутентификации (только для пользователей с ролью "администратор")

6. Регистрация пользователя
- HTTP метод: POST
- Эндпоинт: /users/register
- Тело запроса: JSON с полями username, password, email
- Подтверждение email через письмо
- Ответ: JSON с данными зарегистрированного пользователя

7. Аутентификация пользователя
- HTTP метод: POST
- Эндпоинт: /users/login
- Тело запроса: JSON с полями username, password
- Ответ: JSON с токеном JWT

8. Получение информации о текущем пользователе
- HTTP метод: GET
- Эндпоинт: /users/me
- Ответ: JSON с данными текущего пользователя
- Требует аутентификации

9. Изменение роли пользователя
- HTTP метод: PUT
- Эндпоинт: /users/:id/role
- Тело запроса: JSON с полем role (используйте битовые маски для ролей)
- Ответ: JSON с данными обновленного пользователя
- Требует аутентификации (только для пользователей с ролью "администратор")

## Требования

- Использовать Node.js и фреймворк Express.js
- Использовать TypeScript
- Использовать СУБД PostgreSQL
- Использовать ORM PrismaORM
- Код должен быть хорошо структурирован и читабелен
- Реализация аутентификации и авторизации с использованием JWT

## Необязательно, но будет плюсом:
- Завернуть всё в Docker 

## Оценка

Ваше задание будет оцениваться по следующим критериям:

- Правильность работы API
- Чистота и структура кода
- Использование лучших практик разработки
